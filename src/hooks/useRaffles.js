import { useContext, useEffect, useState } from "react";
import { SetupContext } from "..";
import { useProvider } from "./useProvider";
import { ethers } from "ethers";

const trophies = ["bronze", "silver", "gold", "diamond", "wolf of fame"];

export function useRaffles() {
  const { rafflesContract, rafflesAbi } = useContext(SetupContext);
  const [allRaffles, setAllRaffles] = useState([]);
  const [activeRaffles, setActiveRaffles] = useState([]);
  const [completedRaffles, setCompletedRaffles] = useState([]);
  const { provider, signer } = useProvider();

  const rafflesContractConnected = !!signer
    ? new ethers.Contract(rafflesContract, rafflesAbi, provider).connect(signer)
    : undefined;

  const defaultImageBase64 =
    "data:image/jpeg;base64,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AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAf//EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQMQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAH//xAA0EAAAAwYDBgUEAwEBAQAAAAAAB6QXRWWEw+MTFGAG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";

  function createRaffleObject(
    index,
    entries,
    raffleId,
    minimumTrophyId,
    startTimeStamp,
    duration,
    name,
    winners,
    description,
    drawDate,
    image
  ) {
    const startTimeStampUnix = parseInt(startTimeStamp);
    const durationInSeconds = parseInt(duration);

    const calculatedEndTimeStamp =
      (startTimeStampUnix + durationInSeconds) * 1000;
    let endDate = new Date(calculatedEndTimeStamp);
    // const formattedEndDate = endDate.toISOString().substring(0, 10);

    const yyyy = endDate.getFullYear();
    let MM = endDate.getMonth() + 1; // Months start at 0!
    let dd = endDate.getDate();
    let hh = endDate.getHours();
    let mm = endDate.getMinutes();
    let ss = endDate.getSeconds();

    if (dd < 10) dd = "0" + dd;
    if (MM < 10) MM = "0" + MM;
    if (hh < 10) hh = "0" + hh;
    if (ss < 10) ss = "0" + ss;

    const formattedEndDate =
      dd + "/" + MM + "/" + yyyy + " " + hh + ":" + mm + ":" + ss;

    const today = Date.now();

    const isActive = today <= calculatedEndTimeStamp;

    const minimumTrophyName = trophies[parseInt(minimumTrophyId) - 1];

    return {
      id: index,
      raffleId: raffleId.toString(),
      entries: entries,
      minimumTrophy: minimumTrophyName,
      startTimeStamp: startTimeStamp,
      endTimeStamp: calculatedEndTimeStamp,
      active: isActive,
      endDate: formattedEndDate,
      name: name,
      description: description,
      drawDate: drawDate,
      image: image,
      winners: winners,
    };
  }

  async function checkAndUpdateRaffles() {
    const rafflesResponse = await fetch(
      "https://moonrunners.herokuapp.com/api/raffles"
    );
    const rafflesData = (await rafflesResponse.json()).map(
      (raffle) => raffle || {}
    );
    let i = 0;
    const raffles = [];

    while (i >= 0) {
      try {
        const raffleEvent = await rafflesContractConnected.getRaffle(i);
        const raffleEventString = raffleEvent.toString();
        const raffleEventArray = raffleEventString.split(",");

        const entries = raffleEventArray.slice(0, -3);
        const [minimumTrophyId, startTimeStamp, duration] =
          raffleEventArray.slice(-3);

        let name, winners, description, drawDate, image;

        if (rafflesData[i]) {
          name = rafflesData[i].name ? rafflesData[i].name : "?";
          winners = rafflesData[i].winners ? rafflesData[i].winners : [];
          description = rafflesData[i].description
            ? rafflesData[i].description
            : "?";
          drawDate = rafflesData[i].drawDate
            ? rafflesData[i].drawDate
            : "1703284584";
          image = rafflesData[i].image
            ? rafflesData[i].image
            : defaultImageBase64;
        } else {
          name = "?";
          winners = [];
          description = "?";
          drawDate = "1703284584";
          image = defaultImageBase64;
        }

        const raffleObject = createRaffleObject(
          i,
          entries,
          startTimeStamp,
          minimumTrophyId,
          startTimeStamp,
          duration,
          name,
          winners,
          description,
          drawDate,
          image
        );

        raffles.push(raffleObject);
        const activeRaffles = raffles.filter((raffle) => raffle.active);
        const completedRaffles = raffles.filter((raffle) => !raffle.active);

        setAllRaffles(raffles);
        setActiveRaffles(activeRaffles);
        setCompletedRaffles(completedRaffles);
        i++;
      } catch (error) {
        console.log(error);
        break;
      }
      // Sort the raffles array based on the endTimeStamp property of each raffleObject
      raffles.sort((a, b) => a.endTimeStamp - b.endTimeStamp);

      // Update the active and completed raffles
      const activeRaffles = raffles.filter((raffle) => raffle.active);
      const completedRaffles = raffles.filter((raffle) => !raffle.active);

      setAllRaffles(raffles);
      setActiveRaffles(activeRaffles);
      setCompletedRaffles(completedRaffles);
    }
  }

  useEffect(() => {
    checkAndUpdateRaffles();
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [rafflesContract]);

  return {
    allRaffles,
    activeRaffles,
    completedRaffles,
    checkAndUpdateRaffles,
  };
}
